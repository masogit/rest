<div ui-content-for="navbarAction">
    <a class='btn' ng-click="tempEdit=true" ng-show="nav=='templates' && tempRecords && !tempEdit">
        <i class="fa fa-pencil"></i>
    </a>
    <a class='btn' ng-click="tempEdit=false" ng-show="nav=='templates' && tempRecords && tempEdit">
        <i class="fa fa-close"></i>
    </a>
</div>

<div class="scrollable" ng-init="loadTemplates()">    
    <input type="text" placeholder="Search view..." class="form-control" ng-show="!tempRecords" ng-model="tempSearch">
    <div class="scrollable-content">

        <div class="list-group" ng-show="!tempRecords">
            <span class="list-group-item" ng-repeat="temp in templates|filter:tempSearch" ng-click="loadOneTemp(temp)">
                <strong>{{ temp.name }}</strong>
                <i class="fa fa-chevron-right pull-right"></i>
                <small><span class="pull-right">[{{ temp['$']['sqlname'] }}] </span></small>
            </span>
        </div>

        <div class="section" ng-show="tempRecords && !tempEdit">
            <div class="panel-group" ui-state='myAccordion'>

                <div class="panel panel-default" ng-repeat="record in tempRecords.records">
                    <div class="panel-heading" ui-set="{'myAccordion': $index}">
                        <h4 class="panel-title" ng-click="getRecordByTemp(record, tempRecords, true)">
                            {{ record['self'] }}
                        </h4>
                    </div>
                    <div ui-if="myAccordion == {{$index}}">
                        <div class="panel-body">
                            <small class="pull-right">
                                {{ tempRecord.timeEnd - tempRecord.timeStart }}ms
                            </small>
                            <div ng-show="tempRecord" ng-include="'amTempRecord'"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div ng-show="tempTable && tempEdit" class="section">

            <form name="tempForm">
                <div class="form-group" ng-class="{'has-error': !tempForm.tempName.$valid}">
                    <label>View Name</label>
                    <input type="text" class="form-control" name="tempName" ng-model="tempTable.name" placeholder="Input a Template Name" ng-required="true">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <input type="text" class="form-control" ng-model="tempTable.description" placeholder="Input description">
                </div>
                <div class="form-group">
                    <label>Show Label</label>
                    <ui-switch ng-model="tempTable.showLabel"></ui-switch>
                </div>
                <button class="btn btn-primary btn-block" type="button" 
                        ng-click="saveTemplate(tempTable);tempEdit=false"
                        ng-confirm-click="Save this template?">Save</button>
                <hr>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        Structure
                        <a ng-click="nav='tables'" class="pull-right"><i class="fa fa-pencil"></i></a>
                    </div>
                    <div class="panel-body">
                        <div ng-show="tempTable" ng-include="'amTemp'"></div>
                    </div>
                </div>
                <button class="btn btn-danger btn-block" type="button" 
                        ng-click="removeTemplate(tempTable);tempEdit=false"
                        ng-confirm-click="Delete this template?">Delete</button>
            </form>
        </div>
    </div>
</div>

<script type="text/ng-template" id="amTempRecord">

    <span style="display: none">{{table = (isStructure) ? l.table: (t)?t:tempRecord }}</span>

    <h5>
        <small>
            <span class="fa fa-eye-slash" ng-click="table.showSelf=!table.showSelf" ng-show="!table.showSelf"></span>
            <span class="fa fa-eye" ng-click="table.showSelf=!table.showSelf" ng-show="table.showSelf"></span>
        </small>
        {{ (l['$']['sqlname']) ? l['$']['sqlname'] : table['$']['sqlname'] }}
        <small>({{ table['ID'] }})</small>
    </h5>

    <ul ng-show="!table.showSelf">
        <li ng-repeat="f in table.field"><strong>{{(f.aliasName)?f.aliasName:(tempTable.showLabel)?f['$']['label']:f['$']['sqlname']}}:</strong> {{ formatValue(f['$']['sqlname'],
            f.data) }}
        </li>
    </ul>

    <span ng-show="!table.showSelf" ng-repeat="l in table.link">
        <div ng-show="l.table && l['$']['card11']=='yes'" ng-include="'amTempRecord'" style="padding-left: 20px" ng-init="isStructure=true"></div>
        <div ng-show="l.tables && !l['$']['card11']" style="padding-left: 20px">
            <a ng-click="l.showChild=!l.showChild" ng-show="!l.showChild"><span class="fa fa-plus"></span>
                {{l['$']['sqlname']}} ({{l.tables.length}})
            </a>
            <a ng-click="l.showChild=!l.showChild" ng-show="l.showChild"><span class="fa fa-minus"></span>
                {{l['$']['sqlname']}} ({{l.tables.length}})
            </a> 
            
    <div ng-show="l.showChild" ng-repeat="t in l.tables" ng-include="'amTempRecord'" style="padding-left: 18px" ng-init="isStructure=false"></div>
    </div>
    </span>

</script>

<script type="text/ng-template" id="amTemp">
    <span style="display: none">{{table = (l.table)?l.table:tempTable}}</span>
    <span style="display: none">{{isCard11 = (l['$']['card11'])?true:false}}</span>
    <h5>{{ (l['$']['sqlname'])?l['$']['sqlname']:table['$']['sqlname'] }}
        <small ng-show="!isCard11"><a ng-click="table.AQL=' '" ng-show="!table.AQL">Set AQL</a></small>
    </h5>
    <ul>
        <span ng-show="table.AQL">Set AQL: <input class="form-control" type="text" ng-model="table.AQL"></span>
        <li ng-repeat="f in table.field">
            <span ng-click="f.aliasName=(tempTable.showLabel)?f['$']['label']:f['$']['sqlname']">{{ (tempTable.showLabel)?f['$']['label']:f['$']['sqlname'] }}</span>
            <small ng-show="f.aliasName">
                <span class="glyphicon glyphicon-pencil" contenteditable ng-model="f.aliasName"></span>
            </small>
        </li>
    </ul>
    <span ng-repeat="l in table.link">
        <div ng-show="l.table" ng-include="'amTemp'" style="padding-left: 20px"></div>
    </span>
</script>