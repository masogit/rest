<div ng-show="metadata.tables && !metadata.table">
    <input type="text" class="form-control" placeholder="Search table..." ng-model="tableSearch.id">
    <ul class="nav sidebar">
        <li ng-repeat="table in metadata.tables | filter: tableSearch">
            <a href="#" ng-click="metadata(table.id)">{{ table.id }}</a></li>
    </ul>
</div>

<div ng-show="metadata.table">
    <form class="form-inline">
        <input type="text" class="form-control" placeholder="Search field..." ng-model="fieldSearch" size=10>
        <input type="text" class="form-control" placeholder="Search link..." ng-model="linkSearch" size=10 class="pull-right">
    </form>
    <!-- action -->
    <a ng-click="removeOneTable()" class="badge"><span class="glyphicon glyphicon-arrow-left"></span> {{ metadata.table.name }}</a>
    <a ng-click="addFields()" class="badge pull-right" ng-show="fields.length > 0">
        Filter <span class="glyphicon glyphicon-eye-open"></span></a>

    <div class="sidebar">
        <span style="display: none">{{link.table = metadata.table}}</span>
        <div ng-show="link.table" ng-include="'amTree'"></div>
    </div>
</div>

<script type="text/ng-template" id="amTree">
    <span style="display: none">{{parent = link.table.parent}}</span>
    <span ng-repeat="field in link.table.field | filter: filterFields(fieldSearch)">
        <input type="checkbox"
               ng-checked="fields.indexOf((link.table.parent)?link.table.parent+'.'+field['$']['sqlname']:field['$']['sqlname']) > -1"
               ng-click="toggleCheckbox(fields, (link.table.parent)?link.table.parent+'.'+field['$']['sqlname']:field['$']['sqlname'])">
        {{ field['$']['sqlname'] }}<br>
    </span>
    <span ng-repeat="link in link.table.link | filter: filterFields(linkSearch)" ng-init="link['parent']=parent">
        <a ng-click="metadata(link['$']['desttable'], link)"
           ng-show="!link.table && link['$']['card11']">
            <span class="glyphicon glyphicon-plus"></span>
        </a>

        <a ng-click="foldChild(link)" ng-show="link.table">
            <span class="glyphicon glyphicon-minus"></span>
        </a>

        <a ng-click="metadata(link['$']['desttable'])">[{{ link["$"]["sqlname"] }}]</a> <br>
        <div ng-show="link.table" ng-include="'amTree'" style="padding-left: 10px"></div>
    </span>
</script>